---
title: "FullModel"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

## Scatterplot of proportion dead by age

```{r}

aged <- group_by(training, AGE)
a <- summarize(aged, died = sum(DEATH))
b <- as.data.frame(table(training$AGE))
c <- data.frame("Died" = a, "Total" = b$Freq)
c
d <- mutate(c, proportion = Died.died / Total)
ggplot(d, aes(x = Died.AGE, y = proportion)) + 
  geom_point(aes(size = Total)) 
```

## Create initial model with all terms, all interaction terms, run drop-in-deviance test between the two. 

```{r}
model_AllTerms <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE, family = "binomial")
summary(model_AllTerms)

make.str <- function(set, all){
  final <- paste(set, ":", all, sep = "")
  new <- paste(final, collapse = " + ")
  final <- paste("data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE +", new, ", family =")
  return(final)
}
explanatory <- names(training)[4:16]
make.str("SMOKE", explanatory)

model_AllTermsSEXInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + SEX:AGE + SEX:INDIGENOUS + SEX:DIABETES + SEX:COPD + SEX:ASTHMA + SEX:IMMUNOSUPR + SEX:HYPERTENSION + SEX:OTHER_DIS + SEX:CARDIOVASCULAR + SEX:OBESITY + SEX:CHRONIC_KIDNEY + SEX:SMOKE , family = "binomial")
summary(model_AllTermsSEXInteractions)

model_AllTermsAgeInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + AGE:SEX + AGE:AGE + AGE:INDIGENOUS + AGE:DIABETES + AGE:COPD + AGE:ASTHMA + AGE:IMMUNOSUPR + AGE:HYPERTENSION + AGE:OTHER_DIS + AGE:CARDIOVASCULAR + AGE:OBESITY + AGE:CHRONIC_KIDNEY + AGE:SMOKE, family = "binomial")
summary(model_AllTermsAgeInteractions)

model_AllTermsIndigenousInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + INDIGENOUS:SEX + INDIGENOUS:AGE + INDIGENOUS:INDIGENOUS + INDIGENOUS:DIABETES + INDIGENOUS:COPD + INDIGENOUS:ASTHMA + INDIGENOUS:IMMUNOSUPR + INDIGENOUS:HYPERTENSION + INDIGENOUS:OTHER_DIS + INDIGENOUS:CARDIOVASCULAR + INDIGENOUS:OBESITY + INDIGENOUS:CHRONIC_KIDNEY + INDIGENOUS:SMOKE, family = "binomial")

summary(model_AllTermsIndigenousInteractions)

model_AllTermsDiabetesInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + DIABETES:SEX + DIABETES:AGE + DIABETES:INDIGENOUS + DIABETES:DIABETES + DIABETES:COPD + DIABETES:ASTHMA + DIABETES:IMMUNOSUPR + DIABETES:HYPERTENSION + DIABETES:OTHER_DIS + DIABETES:CARDIOVASCULAR + DIABETES:OBESITY + DIABETES:CHRONIC_KIDNEY + DIABETES:SMOKE, family = "binomial")

summary(model_AllTermsDiabetesInteractions)

model_AllTermsCOPDInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + COPD:SEX + COPD:AGE + COPD:INDIGENOUS + COPD:DIABETES + COPD:COPD + COPD:ASTHMA + COPD:IMMUNOSUPR + COPD:HYPERTENSION + COPD:OTHER_DIS + COPD:CARDIOVASCULAR + COPD:OBESITY + COPD:CHRONIC_KIDNEY + COPD:SMOKE, family = "binomial")

summary(model_AllTermsCOPDInteractions)

model_AllTermsASTHMAInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + ASTHMA:SEX + ASTHMA:AGE + ASTHMA:INDIGENOUS + ASTHMA:DIABETES + ASTHMA:COPD + ASTHMA:ASTHMA + ASTHMA:IMMUNOSUPR + ASTHMA:HYPERTENSION + ASTHMA:OTHER_DIS + ASTHMA:CARDIOVASCULAR + ASTHMA:OBESITY + ASTHMA:CHRONIC_KIDNEY + ASTHMA:SMOKE , family = "binomial")

summary(model_AllTermsASTHMAInteractions)

model_AllTermsIMMUNOSUPRInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + IMMUNOSUPR:SEX + IMMUNOSUPR:AGE + IMMUNOSUPR:INDIGENOUS + IMMUNOSUPR:DIABETES + IMMUNOSUPR:COPD + IMMUNOSUPR:ASTHMA + IMMUNOSUPR:IMMUNOSUPR + IMMUNOSUPR:HYPERTENSION + IMMUNOSUPR:OTHER_DIS + IMMUNOSUPR:CARDIOVASCULAR + IMMUNOSUPR:OBESITY + IMMUNOSUPR:CHRONIC_KIDNEY + IMMUNOSUPR:SMOKE , family = "binomial")

summary(model_AllTermsIMMUNOSUPRInteractions)

model_AllTermsHYPERTENSIONInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + HYPERTENSION:SEX + HYPERTENSION:AGE + HYPERTENSION:INDIGENOUS + HYPERTENSION:DIABETES + HYPERTENSION:COPD + HYPERTENSION:ASTHMA + HYPERTENSION:IMMUNOSUPR + HYPERTENSION:HYPERTENSION + HYPERTENSION:OTHER_DIS + HYPERTENSION:CARDIOVASCULAR + HYPERTENSION:OBESITY + HYPERTENSION:CHRONIC_KIDNEY + HYPERTENSION:SMOKE , family = "binomial")

summary(model_AllTermsHYPERTENSIONInteractions)

model_AllTermsOTHERDISInteraction <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + OTHER_DIS:SEX + OTHER_DIS:AGE + OTHER_DIS:INDIGENOUS + OTHER_DIS:DIABETES + OTHER_DIS:COPD + OTHER_DIS:ASTHMA + OTHER_DIS:IMMUNOSUPR + OTHER_DIS:HYPERTENSION + OTHER_DIS:OTHER_DIS + OTHER_DIS:CARDIOVASCULAR + OTHER_DIS:OBESITY + OTHER_DIS:CHRONIC_KIDNEY + OTHER_DIS:SMOKE , family = "binomial")

summary(model_AllTermsOTHERDISInteraction)

model_AllTermsCARDIOVASCULARInteraction <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + CARDIOVASCULAR:SEX + CARDIOVASCULAR:AGE + CARDIOVASCULAR:INDIGENOUS + CARDIOVASCULAR:DIABETES + CARDIOVASCULAR:COPD + CARDIOVASCULAR:ASTHMA + CARDIOVASCULAR:IMMUNOSUPR + CARDIOVASCULAR:HYPERTENSION + CARDIOVASCULAR:OTHER_DIS + CARDIOVASCULAR:CARDIOVASCULAR + CARDIOVASCULAR:OBESITY + CARDIOVASCULAR:CHRONIC_KIDNEY + CARDIOVASCULAR:SMOKE , family = "binomial")

summary(model_AllTermsCARDIOVASCULARInteraction)

model_AllTermsOBESITYInteraction <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + OBESITY:SEX + OBESITY:AGE + OBESITY:INDIGENOUS + OBESITY:DIABETES + OBESITY:COPD + OBESITY:ASTHMA + OBESITY:IMMUNOSUPR + OBESITY:HYPERTENSION + OBESITY:OTHER_DIS + OBESITY:CARDIOVASCULAR + OBESITY:OBESITY + OBESITY:CHRONIC_KIDNEY + OBESITY:SMOKE , family = "binomial")

summary(model_AllTermsOBESITYInteraction)

model_AllTermsCHRONICKIDNEY <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + CHRONIC_KIDNEY:SEX + CHRONIC_KIDNEY:AGE + CHRONIC_KIDNEY:INDIGENOUS + CHRONIC_KIDNEY:DIABETES + CHRONIC_KIDNEY:COPD + CHRONIC_KIDNEY:ASTHMA + CHRONIC_KIDNEY:IMMUNOSUPR + CHRONIC_KIDNEY:HYPERTENSION + CHRONIC_KIDNEY:OTHER_DIS + CHRONIC_KIDNEY:CARDIOVASCULAR + CHRONIC_KIDNEY:OBESITY + CHRONIC_KIDNEY:CHRONIC_KIDNEY + CHRONIC_KIDNEY:SMOKE , family = "binomial")

summary(model_AllTermsCHRONICKIDNEY)

model_AllTermsSMOKEInteractions <- glm(data = training, DEATH ~ SEX + AGE + INDIGENOUS + DIABETES + COPD + ASTHMA + IMMUNOSUPR + HYPERTENSION + OTHER_DIS + CARDIOVASCULAR + OBESITY + CHRONIC_KIDNEY + SMOKE + SMOKE:SEX + SMOKE:AGE + SMOKE:INDIGENOUS + SMOKE:DIABETES + SMOKE:COPD + SMOKE:ASTHMA + SMOKE:IMMUNOSUPR + SMOKE:HYPERTENSION + SMOKE:OTHER_DIS + SMOKE:CARDIOVASCULAR + SMOKE:OBESITY + SMOKE:CHRONIC_KIDNEY + SMOKE:SMOKE , family = "binomial")

summary(model_AllTermsSMOKEInteractions)

test <- "DEATH ~ SEX"
glm(data = training, test, family = "binomial")
```
This analysis shows that at least some interaction terms are significant. I think we should make our best subsets funciton include none and all interaction terms. This will allow us to pick our best model without interaction terms then select the relevant interaction terms from there. 